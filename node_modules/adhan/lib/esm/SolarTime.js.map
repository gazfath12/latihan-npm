{"version":3,"sources":["../../src/SolarTime.ts"],"names":["Astronomical","degreesToRadians","radiansToDegrees","SolarCoordinates","SolarTime","constructor","date","coordinates","julianDay","getFullYear","getMonth","getDate","observer","solar","prevSolar","nextSolar","m0","approximateTransit","longitude","apparentSiderealTime","rightAscension","solarAltitude","approxTransit","transit","correctedTransit","sunrise","correctedHourAngle","declination","sunset","hourAngle","angle","afterTransit","afternoon","shadowLength","tangent","Math","abs","latitude","inverse","tan","atan"],"mappings":"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","sourcesContent":["import Astronomical from './Astronomical';\nimport type Coordinates from './Coordinates';\nimport { degreesToRadians, radiansToDegrees } from './MathUtils';\nimport SolarCoordinates from './SolarCoordinates';\n\nexport default class SolarTime {\n  observer: Coordinates;\n  solar: SolarCoordinates;\n  prevSolar: SolarCoordinates;\n  nextSolar: SolarCoordinates;\n  approxTransit: number;\n  transit: number;\n  sunrise: number;\n  sunset: number;\n\n  constructor(date: Date, coordinates: Coordinates) {\n    const julianDay = Astronomical.julianDay(\n      date.getFullYear(),\n      date.getMonth() + 1,\n      date.getDate(),\n      0,\n    );\n\n    this.observer = coordinates;\n    this.solar = new SolarCoordinates(julianDay);\n\n    this.prevSolar = new SolarCoordinates(julianDay - 1);\n    this.nextSolar = new SolarCoordinates(julianDay + 1);\n\n    const m0 = Astronomical.approximateTransit(\n      coordinates.longitude,\n      this.solar.apparentSiderealTime,\n      this.solar.rightAscension,\n    );\n    const solarAltitude = -50.0 / 60.0;\n\n    this.approxTransit = m0;\n\n    this.transit = Astronomical.correctedTransit(\n      m0,\n      coordinates.longitude,\n      this.solar.apparentSiderealTime,\n      this.solar.rightAscension,\n      this.prevSolar.rightAscension,\n      this.nextSolar.rightAscension,\n    );\n\n    this.sunrise = Astronomical.correctedHourAngle(\n      m0,\n      solarAltitude,\n      coordinates,\n      false,\n      this.solar.apparentSiderealTime,\n      this.solar.rightAscension,\n      this.prevSolar.rightAscension,\n      this.nextSolar.rightAscension,\n      this.solar.declination,\n      this.prevSolar.declination,\n      this.nextSolar.declination,\n    );\n\n    this.sunset = Astronomical.correctedHourAngle(\n      m0,\n      solarAltitude,\n      coordinates,\n      true,\n      this.solar.apparentSiderealTime,\n      this.solar.rightAscension,\n      this.prevSolar.rightAscension,\n      this.nextSolar.rightAscension,\n      this.solar.declination,\n      this.prevSolar.declination,\n      this.nextSolar.declination,\n    );\n  }\n\n  hourAngle(angle: number, afterTransit: boolean) {\n    return Astronomical.correctedHourAngle(\n      this.approxTransit,\n      angle,\n      this.observer,\n      afterTransit,\n      this.solar.apparentSiderealTime,\n      this.solar.rightAscension,\n      this.prevSolar.rightAscension,\n      this.nextSolar.rightAscension,\n      this.solar.declination,\n      this.prevSolar.declination,\n      this.nextSolar.declination,\n    );\n  }\n\n  afternoon(shadowLength: number) {\n    // TODO source shadow angle calculation\n    const tangent = Math.abs(this.observer.latitude - this.solar.declination);\n    const inverse = shadowLength + Math.tan(degreesToRadians(tangent));\n    const angle = radiansToDegrees(Math.atan(1.0 / inverse));\n    return this.hourAngle(angle, true);\n  }\n}\n"],"file":"SolarTime.js"}